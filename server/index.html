<!DOCTYPE html>
<html>
<head>
    <title>Server App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #status {
            margin-top: 20px;
            font-weight: bold;
        }
        #uuid {
            margin-top: 10px;
            font-style: italic;
        }
        #shareScreen, #stopShare, #copyUUID {
            margin-top: 10px;
            padding: 10px;
            border: none;
            cursor: pointer;
            font-size: 10px;
        }
        #shareScreen {
            background-color: #007bff;
            color: white;
        }
        #stopShare {
            background-color: red;
            color: white;
            display: none; /* Initially hidden */
        }
        #copyUUID {
            background-color: #ababab;
            color: black;
            display: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            margin-left: 5px;
            border-radius: 7px;
        }
        .uuidContainer {
            display: flex;
            align-items: center;
        }
        .uuidContainer i {
            margin-left: 5px; /* Space between UUID and icon */
        }
        /* New CSS for IP address */
        #ipAddress {
            margin-top: 10px;
            color: green;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Server App</h1>
    
    <!-- New div for displaying IP address -->
    <div id="ipAddress">Fetching IP address...</div>
    
    <button id="shareScreen">Share Screen</button>
    <button id="stopShare">Stop Sharing</button>
    <div id="status">Waiting for client...</div>
    <div class="uuidContainer">
        <div id="uuid"></div>
        <button id="copyUUID" title="Copy UUID"><i class="fas fa-copy"></i></button>
    </div>

    <!-- Material-UI Snackbar -->
    <div id="snackbar" style="position: fixed; bottom: 20px; right: 20px; display: none; background-color: #323232; color: white; padding: 16px; border-radius: 4px;">
        UUID copied to clipboard!
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        const socket = require('socket.io-client')('http://localhost:3000');

        // Listen for the server IP address from the main process
        ipcRenderer.on('server-ip', (event, ipAddress) => {
            document.getElementById('ipAddress').innerText = `Server IP Address: ${ipAddress}`;
        });
        

        // Click to request UUID and start screen sharing
        document.getElementById('shareScreen').addEventListener('click', () => {
            socket.emit('requestUUID');
            document.getElementById('status').innerText = 'Generating UUID...';
        });

        // Click to stop screen sharing
        document.getElementById('stopShare').addEventListener('click', () => {
            socket.emit('stopSharing');
            document.getElementById('status').innerText = 'Screen sharing stopped.';
            document.getElementById('stopShare').style.display = 'none';  // Hide stop button
            document.getElementById('shareScreen').style.display = 'inline-block';  // Show share screen button
        });

        // When a new UUID is generated, display it
        socket.on('newUUID', (uuid) => {
            document.getElementById('uuid').innerText = `Generated UUID: ${uuid}`;
            document.getElementById('status').innerText = 'Waiting for client connection...';
            document.getElementById('copyUUID').style.display = 'inline-block'; // Show copy UUID button
        });

        // When a client connects, update the status and toggle buttons
        socket.on('clientConnected', () => {
            document.getElementById('status').innerText = 'Client connected!';
            document.getElementById('shareScreen').style.display = 'none';  // Hide share screen button
            document.getElementById('stopShare').style.display = 'inline-block';  // Show stop sharing button
        });

        // When a client disconnects, reset the buttons and status
        socket.on('clientDisconnected', () => {
            document.getElementById('status').innerText = 'Client disconnected!';
            document.getElementById('stopShare').style.display = 'none';  // Hide stop button
            document.getElementById('shareScreen').style.display = 'inline-block';  // Show share screen button
        });

        // When a server disconnects, reset the buttons and status
        socket.on('serverDisconnected', () => {
            document.getElementById('status').innerText = 'Connection disconnected!';
            document.getElementById('stopShare').style.display = 'none';  // Hide stop button
            document.getElementById('shareScreen').style.display = 'inline-block';  // Show share screen button
        });

        // Copy UUID to clipboard
        document.getElementById('copyUUID').addEventListener('click', () => {
            const uuidText = document.getElementById('uuid').innerText;
            if (uuidText) {
                const uuidValue = uuidText.replace('Generated UUID: ', ''); // Extract the UUID
                navigator.clipboard.writeText(uuidValue).then(() => {
                    showSnackbar('UUID copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                });
            }
        });

        // Function to show Snackbar
        function showSnackbar(message) {
            const snackbar = document.getElementById('snackbar');
            snackbar.innerText = message;
            snackbar.style.display = 'block';
            setTimeout(() => {
                snackbar.style.display = 'none';
            }, 3000); // Adjust duration as needed (3 seconds)
        }
    </script>
</body>
</html>
